---
 - hosts: AWX
   become_user: azureuser
   tasks:
    - name: Login in
      shell: oc login {{ openshift_url }} -u admin -p {{ password1 }} --insecure-skip-tls-verify=true

    - name: Create Project
      shell: oc create namespace {{ namespaces }}

    - name: Copy operator-config
      template:
        src: ./templates/{{operatorconfig}}.j2
        dest: "{{ operatorconfig }}".yaml

    - name: Install operatorscript on namespace scope
      shell: oc apply -f {{operatorconfig}} -n {{ namespaces }}      

#    - name: Create Catalog
#      template:
#        src: ./templates/entando-catalog.j2
#        dest: entando-catalog.yaml

#    - name: Install operator on namespace scope
#      shell: oc apply -f entando-catalog.yaml -n {{ namespaces }}

    - name: Copy Operator Script
      template:
        src: ./templates/entando-subscription.j2
        dest: entando-subscription.yaml

    - name: Install operatorscript on namespace scope
      shell: oc apply -f entando-subscription.yaml -n {{ namespaces }}

    - name: Copy Entando App Script
      template:
        src: ./templates/entando-app.j2
        dest: entando-app.yaml

    - name: Install Entando App on namespace scope
      shell: oc apply -f entando-app.yaml -n {{ namespaces }}
