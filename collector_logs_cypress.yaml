---
 - hosts: AWX
   become_user: azureuser
   tasks:
   
    - name: Create Dir Cypress results
      shell: mkdir -p /home/azureuser/log-collector/{{ APPNAME }}/results
      
    - name: Collect all Cypress logs to local
      shell: kubectl get pods -n cypress --no-headers | awk '//{print $1}' | while read PODS;do kubectl logs $PODS -n cypress > /home/azureuser/log-collector/{{ APPNAME }}/$PODS.log;done

    - name: Copy Cypress results
      shell: kubectl cp cypress/cypress:/opt/entando-test-automation/ui-tests/cypress/results /home/azureuser/log-collector/{{ APPNAME }}/results
