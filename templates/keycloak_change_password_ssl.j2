#!/bin/bash
KEYCLOAK_HOST=https://{{ HOST }}
ADMIN_USER_NEW_PASSWORD=adminadmin
ACCESS_TOKEN=$(curl \
-d "client_id=admin-cli" \
-d "username=entando_keycloak_admin" \
-d "password={{ PASSWORD }}" \
-d "grant_type=password" \
"https://{{ HOST }}/auth/realms/master/protocol/openid-connect/token" | jq -r '.access_token')
echo $ACCESS_TOKEN
curl -X GET -H "Authorization: Bearer $ACCESS_TOKEN" https://{{ HOST }}/auth/admin/realms/master/users | jq
curl -X GET -H "Authorization: Bearer $ACCESS_TOKEN" https://{{ HOST }}/auth/admin/realms/entando/users | jq
ADMIN_USER_ID=$(curl -X GET -H "Authorization: Bearer $ACCESS_TOKEN" https://{{ HOST }}/auth/admin/realms/entando/users | jq -r '.[] | select(.username=="admin") | .id')
echo ADMIN_USER_ID
curl -s -X PUT -H "Authorization: Bearer $ACCESS_TOKEN" -H "Content-type: application/json;charset=UTF-8" -H 'Accept: application/json' "{{ HOST }}/auth/admin/realms/entando/users/$ADMIN_USER_ID/reset-password" -d "{\"type\":\"password\",\"value\":\"$ADMIN_USER_NEW_PASSWORD\",\"temporary\":false}"