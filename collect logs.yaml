---
 - hosts: AWX
   become: yes
   become_user: "{{ username }}"
   tasks:
   
    - name: Create Dir Logs
      shell: mkdir -p /home/{{ username }}/log-collector/{{ APPNAME }}/results
      
    - name: Collect all Entando application logs from pods
      shell: kubectl get pods -n entando --no-headers | awk '{print $1}' | while read PODS;do kubectl logs $PODS -n entando > /home/{{ username }}/log-collector/{{ APPNAME }}/$PODS.log;done
      
    - name: Copy Cypress results
      shell: kubectl cp cypress/cypress:/opt/entando-test-automation/ui-tests/cypress/results /home/{{ username }}/log-collector/{{ APPNAME }}/results
      
    - name: Delete namespace entando 
      shell: kubectl delete ns entando
      
    - name: Delete namespace cypress 
      shell: kubectl delete ns cypress
      
    - name: Publish Logs 
      shell: mv /home/{{ username }}/log-collector/* /var/www/html/logs/eks1.21/
