---
 - hosts: AWX
   become_user: azureuser
   tasks:

    - name: Collect all Entando application logs from pods
      command: oc get pods -n entando --no-headers | awk '{print $1}' | while read PODS:do kubectl logs $PODS -n entando > /home/azureuser/log-collector/$PODS-$(date).log;done
      
    - name: Collect all Cypress logs to local
      command: oc get pods -n cypress --no-headers | awk '{print $1}' | while read PODS:do kubectl logs $PODS -n cypress > /home/azureuser/log-collector/$PODS-$(date).log;done

    - name: Copy Cypress results
      shell: kubectl cp cypress/cypress:/opt/entando-test-automation/ui-tests/configs/* /home/azureuser/log-collector/
