---
 - hosts: AWX
   become_user: azureuser
   tasks:
   
   - name: Get url
     shell: kubectl get svc -n ingress-nginx |grep LoadBalancer | awk '{print $4}' | while read HOST;do 
            curl "http://$HOST/auth/";done

   - name: Get url
     shell: kubectl get svc -n ingress-nginx |grep LoadBalancer | awk '{print $4}' | while read HOST;do 
            echo "http://$HOST/app-builder/" > webportal;done            

#   - name: Curl website
#     uri:
#      url: "{{ entando_application_var }}"
#      return_content: yes
#     register: webpage
     
   - name: Curl website
     shell: cat webportal | awk '{{print $1}}' | while read WEBPORTAL;do curl $WEBPORTAL;done
     register: webpage
   - debug: var=webpage.stdout
   - name: Fail
     fail:
     when: "'entando' not in webpage.stdout" 
   - name: Success
     debug: msg="Congrats Yours HW Assignment is completed"
