---
 - hosts: AWX
   become: yes
   become_user: "{{ username }}"
   environment:
     - PATH: '{{ lookup(''env'', ''PATH'') }}:/home/{{ username }}/.local/bin/aws'
     - PATH: '{{ lookup(''env'', ''PATH'') }}:/home/{{ username }}/.entando/ent/v7.0.1/cli/v7.0.0/bin'
   tasks:
   
    - name: Select working dir
      command: cd /home/{{ username }}
      
    - name: Copy Bundle script Script
      template:
        src: ./templates/simple_bundle.j2
        dest: /home/{{ username }}/simple_bundle.yaml
        
    - name: Deploy bundle
      shell: chdir=/home/{{ username }} kubectl apply -f /home/{{ username }}/simple_bundle.yaml -n {{ namespace }}

    - name: Configure Ent namespace
      shell: chdir=/home/{{ username }} ent namespace {{ namespace }}

    - name: Configure ent app
      shell: chdir=/home/{{ username }} ent appname {{ appname }}

    - name: Install bundle
      shell: chdir=/home/{{ username }} ent ecr install --name app1
