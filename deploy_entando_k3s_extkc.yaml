---
 - hosts: AWX
   become: yes
   become_user: "{{ username }}"
   tasks:
   
    - name: Select working dir
      command: cd /home/{{ username }}

    - name: Sleep for 20 seconds and continue
      wait_for:
        timeout: 5
      
    - name: Generate external keycloak yaml file
      template:
        src: ./templates/entando_installation_k3s_extkc.j2
        dest: /home/{{ username }}/entando_installation_k3s_extkc.sh

    - name: Change Permission 
      shell: chdir=/home/{{ username }} chmod +x entando_installation_k3s_extkc.sh
      
    - name: Execute installation script
      shell: chdir=/home/{{ username }} ./entando_installation_k3s_extkc.sh {{ namespace }} {{ APPNAME }}
      register: results
      
    - name: Print Results
      debug:
        msg: "{{ results }}"